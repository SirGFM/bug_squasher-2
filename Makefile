
#==============================================================================
# Define every object required by compilation
#==============================================================================
  OBJS =                             \
          $(OBJDIR)/main.o           \
          $(OBJDIR)/state_mainMenu.o 
#==============================================================================

#==============================================================================
# Basic settings
#==============================================================================
  CC := gcc
# Check if should compile debug version
  ifneq (,$(findstring debug, $(MAKECMDGOALS)))
    DEBUG := yes
    RELEASE := no
  endif
# Check if should compile release version
  ifneq (,$(findstring release, $(MAKECMDGOALS)))
    DEBUG := no
    RELEASE := yes
  endif
# By default, compile in debug mode
  ifeq ($(MAKECMDGOALS),)
    DEBUG := yes
    RELEASE := no
  endif
#==============================================================================

#==============================================================================
# Clear the suffixes' default rule, since there's an explicit one
#==============================================================================
.SUFFIXES:
#==============================================================================

#==============================================================================
# Define all targets that doesn't match its generated file
#==============================================================================
.PHONY: all clean debug distclean release
#==============================================================================

#==============================================================================
# Define compilation target
#==============================================================================
  TARGET := bugsquasher-2
# If the DEBUG flag was set, generate another binary (so it doesn't collide
# with the release one)
  ifeq ($(DEBUG), yes)
    TARGET := $(TARGET)_dbg
  endif
#==============================================================================

#==============================================================================
# Set OS flag
#==============================================================================
  OS := $(shell uname)
  ifeq ($(OS), MINGW32_NT-6.1)
    OS := Win
  endif
#==============================================================================

#==============================================================================
# Define CFLAGS (compiler flags)
#==============================================================================
# Add all warnings and default include path
  CFLAGS := -Wall -I"./include/"
# Add architecture flag
  ARCH := $(shell uname -m)
  ifeq ($(ARCH), x86_64)
    CFLAGS := $(CFLAGS) -m64
  else
    CFLAGS := $(CFLAGS) -m32
  endif
# Add debug flags
  ifneq ($(DEBUG), yes)
    CFLAGS := $(CFLAGS) -g -O0 -DDEBUG
  endif
  ifeq ($(RELEASE), yes)
    CFLAGS := $(CFLAGS) -O3
  endif
# Set flags required by OS
  ifeq ($(OS), Win)
    CFLAGS := $(CFLAGS) -I"/d/windows/mingw/include" -I"/c/GFraMe/include"
  else
    CFLAGS := $(CFLAGS) -fPIC
  endif
#==============================================================================

#==============================================================================
# Define LFLAGS (linker flags)
#==============================================================================
  ifeq ($(RELEASE), yes)
    LFLAGS := -lGFraMe
  endif
  ifeq ($(DEBUG), yes)
    LFLAGS := -lGFraMe_dbg
  endif
# Add libs and paths required by an especific OS
  ifeq ($(OS), Win)
    LFLAGS := -L"/c/GFraMe/lib" $(LFLAGS) -L"/d/windows/mingw/mingw32/lib"
    LFLAGS := -mwindows -lmingw32 $(LFLAGS) -lSDL2main
  else
    LFLAGS := -L/usr/lib/GFraMe/ $(LFLAGS)
  endif
#==============================================================================

#==============================================================================
# Define where source files can be found and where objects & binary are output
#==============================================================================
 VPATH := src
 OBJDIR := obj/$(OS)
 BINDIR := bin/$(OS)
#==============================================================================

#==============================================================================
# Make the objects list constant (and the icon, if any)
#==============================================================================
 OBJS := $(OBJS)
#==============================================================================

#==============================================================================
# Define default compilation rule
#==============================================================================
all: MAKEDIRS $(BINDIR)/$(TARGET)
	date
#==============================================================================

#==============================================================================
# Dummy release and debug rules
#==============================================================================
release: all

debug: all
#==============================================================================

#==============================================================================
# Rule for actually building the game
#==============================================================================
$(BINDIR)/$(TARGET): MAKEDIRS $(OBJS)
	$(CC) $(CFLAGS) -o $@ $(OBJS) $(LFLAGS)
#==============================================================================

#==============================================================================
# Rule for compiling any .c in its object
#==============================================================================
$(OBJDIR)/%.o: %.c
	$(CC) $(CFLAGS) -o $@ -c $<
#==============================================================================

#==============================================================================
# Rule for creating every directory
#==============================================================================
MAKEDIRS: | $(OBJDIR)
#==============================================================================

#==============================================================================
# Rule for actually creating every directory
#==============================================================================
$(OBJDIR):
	mkdir -p $(OBJDIR)
	mkdir -p $(BINDIR)
#==============================================================================

#==============================================================================
# Removes all built objects (use emscript_clean to clear the emscript stuff)
#==============================================================================
clean:
	rm -f $(OBJS)
	rm -f $(BINDIR)/$(TARGET)
#==============================================================================

#==============================================================================
# Remove all built objects and target directories
#==============================================================================
distclean: clean
	rmdir $(OBJDIR)
	rmdir $(BINDIR)
#==============================================================================

